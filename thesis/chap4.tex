\part{Расширение предметно-ориентированных языков механизмами композиции}\label{part4}

Механизмы композиции на основе шаблонов и аспектов являются \term{ инфраструктурными}: они практически не зависят от предметной области, в которой будет применяться язык. Это позволяет выработать метод реализации таких механизмов: ``ядро'' языка, состоящее из конструкций, выражающих понятия предметной области, может быть расширено этими механизмами, реализация которых добавляется к реализации ядра, практически с ней не взаимодействуя. По сути, данные механизмы работают в режиме препроцессора: сначала выполняется композиция, в результате которой получаются конструкции ядра, в свою очередь обрабатываемые сообразно назначению языка.

В данной главе этот метод описан в виде поэтапной процедуры, все шаги которой могут быть выполнены автоматически. Первый раздел посвящен способу описания ядра языка, основанному на существующих средствах разработки предметно-ориентированных языков, не поддерживающих сложных механизмов композиции. Второй и третий разделы посвящены расширению языков шаблонами и аспектами, соответственно. Далее приведен пример применения описанного метода и сравнение его с существующими подходами.

\input{chap4basic.tex}
\input{chap4temp.tex}
\input{chap4aspects.tex}

\chapter{Пример: расширение языка \tool{Emfatic}}

\begin{lstlisting}
specification : classifier*;
classifier
	: class
	: enum
	: data
	;
class
	: 'abstract'? 'class' NAME ('extends' <List NAME, ','>)? '{'
		feature*
	  '}'
	;
feature
	: 'attr' sign
	: 'ref' sign
	: 'val' sign
	;
sign : NAME ':' type;
type : NAME ('*' | '+' | '?')?;
enum : 'enum' NAME '{' <List NAME, ','> '}' ;
data : 'data' NAME '=' STRING ;
\end{lstlisting}

\begin{lstlisting}
template List<N, T> {
	class N {
		
	}
}

\end{lstlisting}

шаблоны

аспекты

\chapter{Сравнение с существующими подходами}

Результаты сравнения предложенного в данной главе подхода с описанными в литературе приведены таблицах \ref{TmpTable} и \ref{AspTable}. Шаблоны и аспекты рассматривались отдельно, поскольку, кроме проекта \tool{Reuseware}, ни один подход не обеспечивает расширение языков обоими механизмами композиции. Детальное сравнение предложенного в данной главе подхода с подходом проекта \tool{Reuseware} приведено в конце данного раздела.

\begin{table}[htb]
	\centering
\newcommand{\dissonly}[1]{#1}
\input{templates.table.tex}
	\caption{Поддержка шаблонов}\label{TmpTable}
\end{table}

Для сравнения возможностей по поддержке шаблонов (\tabref{TmpTable}) были выбраны семь проектов. Сравнение проводилось по следующим критериям:
\begin{itemize}
	\item[(а)] наличие поддержки внешних ПОЯ; три из семи проектов базируются на конкретных языках программирования и пригодны, таким образом, только для разработки исполняемых внутренних предметно-ориентированных языков;
	\item[(б)] поддержка текстовых языков (рассматривалось только для внешних ПОЯ);
	\item[(в)] \term{замкнутость} расширенного языка --- синтаксическая интеграция механизма шаблонов с другими конструкциями языка;
	\item[(г)] контроль корректности использования шаблонов, выполняемый \emph{до} разворачивания --- эта возможность очень важна, поскольку позволяет рано обнаруживать и быстро исправлять ошибки;
	\item[(д)] поддержка в теле шаблона сложной логики (условий, циклов и т. д.).
\end{itemize}	
Отдельной строкой в таблице указано, какой термин использует данный проект: ``шаблон'' (``T'' от ``template'') или макроопределение (``M'' от ``macro''); видно, что частота употребления терминов примерно совпадает\footnote{Проект \tool{Reuseware} использует термин ``component fragment'' для обозначения того же понятия, в таблице это отражено аббревиатурой ``CF''.}.
	
Из таблицы видно, что только предложенный в данной работе подход позволяет расширять текстовые внешние ПОЯ шаблонами в замкнутой форме, при этом обеспечивая контроль корректности. Подходы основанные на конкретных языках программирования не позволяют создавать внешние ПОЯ. Препроцессор \tool{cpp} и генераторы текста (\tool{Velocity} и др.) не осуществляют контроль корректности до разворачивания шаблона. \tool{MPS} не поддерживает текстовые языки, что создает необходимость в поддержке сложными инструментами и трудности в интеграции с другими средствами разработки, а \tool{Reuseware} создает незамкнутый механизм шаблонов.

Результаты аналогичного сравнения для аспектов приведены в таблице \tabref{AspTable}.  Сравнение проводилось последующим критериям:
\begin{table}[htb]
	\centering
\newcommand{\dissonly}[1]{#1}
\input{aspects.table.tex}
	\caption{Поддержка аспектов}\label{AspTable}
\end{table}
\begin{itemize}
	\item[(а)] поддержка рассматриваемой технологией многих языков как общего назначения, так и предметно-ориентированных; отдельно рассматривались 
		независимость от платформы (здесь под платформой понимается аппаратно-программная среда, то есть виртуальные машины (\tool{Java}, \tool{.NET}) тоже считаются платформами,
		поддержка неисполняемых языков --- ярким примером такого языка \GRM{}, поддержка аспектов в котором весьма полезна,
		автоматизация разработки --- ряд работ предлагает методики, основанные на тех или иных парадигмах программирования, не автоматизирующих разработку, а предлагающих более удобный способ ручной разработки;
	\item[(б)] поддержка аспектами незнания;
	\item[(в)] наличие специализированного языка срезов: в работе \cite{VanWyk03} срезы предлагается реализовывать как функции на языке \tool{Haskell}, что затрудняет их написание и, давая б\'{о}льшие возможности, увеличивает вероятность ошибки;
	\item[(г)] описывается ли в рамках подхода семантика встраивания советов.
\end{itemize}
Из таблицы видно, что только предложенный в данной работе подход поддерживает все указанные возможности.

Как было сказано выше, подход проекта \tool{Reuseware} \cite{Reuseware} наиболее близок к предложенному в данной главе, поскольку он также обладает следующими важными преимуществами:
(а) обеспечивает структурную корректность результатов, (б) используем единый формализм для описания шаблонов и аспектов. Также как и предложенный подход, \tool{Reuseware} не поддерживает условных операторов и циклов в теле шаблона. Недостатками \tool{Reuseware} по сравнению с нашим подходом являются 
\begin{itemize}
\item незамкнутость шаблонов --- базовый язык шаблонов не интегрируется с расширяемым языком и требует отдельной инструментальной поддержки,
\item отсутствие незнания и языка срезов в аспектах --- точки встраивания должны быть специальным образом подготовлены для расширения и явно отмечены.
\end{itemize}

\chapter{Выводы}

Предложен автоматизированный подход к расширению предметно-ориентированных языков поддержкой композиции на основе шаблонов и аспектов, гарантирующих структурную корректность результатов композиции. Данный подход позволяет сократить сроки создания языков с поддержкой указанных механизмов композиции, поскольку данные механизмы не требуется разрабатывать вручную.

// Emfatic